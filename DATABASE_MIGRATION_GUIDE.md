# データベース移行ガイド

## 概要

このプロジェクトは、localStorageベースのデモモードからSupabaseデータベースベースの本格運用モードへの移行をサポートしています。

## 移行の流れ

### 1. Supabaseプロジェクトのセットアップ

1. [Supabase](https://supabase.com)でアカウントを作成
2. 新しいプロジェクトを作成
3. プロジェクトのURLとAPIキーを取得

### 2. 環境変数の設定

`.env`ファイルを作成し、以下の内容を設定：

```env
# Supabase設定
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key

# アプリケーション設定
VITE_APP_NAME=Orderly
VITE_APP_VERSION=1.0.0
```

### 3. データベーステーブルの作成

SupabaseのSQLエディタで`database-setup.sql`の内容を実行：

```sql
-- テーブル作成
-- テストデータ挿入
-- インデックス作成
-- RLS設定
```

### 4. アプリケーションの起動

```bash
npm install
npm run dev
```

## 動作モード

### デモモード（デフォルト）
- 環境変数が設定されていない場合
- localStorageを使用
- デモデータで動作

### データベースモード
- 環境変数が正しく設定されている場合
- Supabaseデータベースを使用
- 自動的にデータ移行を実行

## データ移行

初回起動時に、以下のデータが自動的に移行されます：

- 供給元データ（10件）
- 商品データ（15件）
- 在庫データ（店舗別）
- テストユーザーデータ

## 認証

### デモモード
- メール: `admin@demo.com`, `manager@demo.com`, `staff@demo.com`
- パスワード: `password`

### データベースモード
- Supabase Authを使用
- 実際のユーザー登録・認証が必要

## 機能比較

| 機能 | デモモード | データベースモード |
|------|------------|-------------------|
| 認証 | ローカル | Supabase Auth |
| データ保存 | localStorage | PostgreSQL |
| リアルタイム | なし | あり |
| マルチユーザー | 制限あり | 完全対応 |
| バックアップ | なし | 自動 |
| スケーラビリティ | 制限あり | 高 |

## トラブルシューティング

### よくある問題

1. **環境変数が読み込まれない**
   - `.env`ファイルの場所を確認
   - アプリケーションを再起動

2. **データベース接続エラー**
   - Supabaseプロジェクトの状態を確認
   - URLとAPIキーを再確認

3. **移行エラー**
   - ブラウザのコンソールでエラーを確認
   - データベースのテーブル構造を確認

### ログの確認

ブラウザの開発者ツールのコンソールで、以下のログを確認：

- `データベース移行を開始します...`
- `データベースからの商品取得に失敗:`
- `Session check error:`

## 本格運用への移行

1. **セキュリティ設定**
   - RLSポリシーの詳細設定
   - APIキーの制限設定

2. **パフォーマンス最適化**
   - インデックスの追加
   - クエリの最適化

3. **監視・アラート**
   - エラーログの監視
   - パフォーマンスメトリクス

## サポート

問題が発生した場合は、以下を確認してください：

1. ブラウザのコンソールエラー
2. Supabaseダッシュボードのログ
3. ネットワークタブのリクエスト/レスポンス

詳細なエラーメッセージとともにサポートを依頼してください。




